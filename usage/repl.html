<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Babashka book</title>
    <link rel="canonical" href="https://book.babashka.org/gh-pages/usage/repl.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="stylesheet" href="../../_/css/site-extra.css">
<!--<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css">-->
<!--<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">-->
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <a href="https://book.babashka.org">Babashka book</a>
        <!--<span class="separator">//</span>
        <a href="https://book.babashka.org">Docs</a>-->
      </div>
      <!--<div class="navbar-item">
        <input id="search-input" type="text" placeholder="Search docs">
      </div>-->
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <!--<div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Projects</a>
          <div class="navbar-dropdown">
              <a class="navbar-item" href="https://github.com/clojure-emacs/cider">CIDER</a>
              <a class="navbar-item" href="https://github.com/clojure-emacs/cider-nrepl">CIDER nREPL</a>
              <a class="navbar-item" href="https://github.com/clojure-emacs/orchard">Orchard</a>
              <a class="navbar-item" href="https://github.com/clojure-emacs/clojure-mode">clojure-mode</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Community</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="/cider/about/support.html">Support</a>
            <a class="navbar-item" href="/cider/contributing.html">Contributing</a>
            <a class="navbar-item" href="https://opencollective.com/cider">Open Collective</a>
          </div>
        </div>
      </div>
    </div>-->
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="gh-pages" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../intro.html">Babashka</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../intro.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../getting_started.html">Getting started</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../usage.html">Usage</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="repl.html">Running a REPL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="classpath.html">Classpath</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="preloads.html">Preloads</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="io-flags.html">Input and output flags</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../style.html">Style</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../libraries.html">Libraries</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../pods.html">Pods</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../child_processes.html">Child processes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../deps_clj.html">Deps.clj</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../recipes.html">Recipes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../differences.html">Differences with Clojure</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../contributing.html">Contributing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../license.html">License</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Babashka</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Babashka</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../intro.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../intro.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../intro.html">Babashka</a></li>
    <li><a href="../usage.html">Usage</a></li>
    <li><a href="repl.html">Running a REPL</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///Users/borkdude/Dropbox/dev/clojure/babashka.book/src/modules/ROOT/pages/usage/repl.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<div class="sect1">
<h2 id="repl"><a class="anchor" href="#repl"></a>Running a REPL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Babashka supports running a REPL, a socket REPL and an nREPL server.</p>
</div>
<div class="sect2">
<h3 id="_repl"><a class="anchor" href="#_repl"></a>REPL</h3>
<div class="paragraph">
<p>To start a REPL, type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ bb --repl</code></pre>
</div>
</div>
<div class="paragraph">
<p>To get history with up and down arrows, use <a href="https://github.com/hanslub42/rlwrap">rlwrap</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ rlwrap bb --repl</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_socket_repl"><a class="anchor" href="#_socket_repl"></a>Socket REPL</h3>
<div class="paragraph">
<p>To start a socket REPL on port <code>1666</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ bb --socket-repl 1666
Babashka socket REPL started at localhost:1666</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you can connect with your favorite socket REPL client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ rlwrap nc 127.0.0.1 1666
Babashka v0.0.14 REPL.
Use :repl/quit or :repl/exit to quit the REPL.
Clojure rocks, Bash reaches.

bb=&gt; (+ 1 2 3)
6
bb=&gt; :repl/quit
$</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>--socket-repl</code> option takes options similar to the <code>clojure.server.repl</code>
Java property option in Clojure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-clojure hljs" data-lang="clojure">$ bb --socket-repl '{:address "0.0.0.0" :accept clojure.core.server/repl :port 1666}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Editor plugins and tools known to work with a babashka socket REPL:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Emacs: <a href="https://github.com/clojure-emacs/inf-clojure">inf-clojure</a>:</p>
<div class="paragraph">
<p>To connect:</p>
</div>
<div class="paragraph">
<p><code>M-x inf-clojure-connect &lt;RET&gt; localhost &lt;RET&gt; 1666</code></p>
</div>
<div class="paragraph">
<p>Before evaluating from a Clojure buffer:</p>
</div>
<div class="paragraph">
<p><code>M-x inf-clojure-minor-mode</code></p>
</div>
</li>
<li>
<p>Atom: <a href="https://github.com/mauricioszabo/atom-chlorine">Chlorine</a></p>
</li>
<li>
<p>Vim: <a href="https://github.com/liquidz/vim-iced">vim-iced</a></p>
</li>
<li>
<p>IntelliJ IDEA: <a href="https://cursive-ide.com/">Cursive</a></p>
<div class="paragraph">
<p>Note: you will have to use a workaround via
<a href="https://github.com/mfikes/tubular">tubular</a>. For more info, look
<a href="https://cursive-ide.com/userguide/repl.html#repl-types">here</a>.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_prepl"><a class="anchor" href="#_prepl"></a>pREPL</h3>
<div class="paragraph">
<p>Launching a prepl can be done as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-clojure hljs" data-lang="clojure">$ bb --socket-repl '{:address "0.0.0.0" :accept clojure.core.server/io-prepl :port 1666}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>or programmatically:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-clojure hljs" data-lang="clojure">$ bb -e '(clojure.core.server/io-prepl)'
(+ 1 2 3)
{:tag :ret, :val "6", :ns "user", :ms 0, :form "(+ 1 2 3)"}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_nrepl"><a class="anchor" href="#_nrepl"></a>nREPL</h3>
<div class="paragraph">
<p>To start an nREPL server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ bb --nrepl-server 1667</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then connect with your favorite nREPL client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-clojure hljs" data-lang="clojure">$ lein repl :connect 1667
Connecting to nREPL at 127.0.0.1:1667
user=&gt; (+ 1 2 3)
6
user=&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Editor plugins and tools known to work with the babashka nREPL server:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Emacs: <a href="https://docs.cider.mx/cider/platforms/babashka.html">CIDER</a></p>
</li>
<li>
<p><code>lein repl :connect</code></p>
</li>
<li>
<p>VSCode: <a href="http://calva.io/">Calva</a></p>
</li>
<li>
<p>Atom: <a href="https://github.com/mauricioszabo/atom-chlorine">Chlorine</a></p>
</li>
<li>
<p>(Neo)Vim: <a href="https://github.com/liquidz/vim-iced">vim-iced</a>,
<a href="https://github.com/Olical/conjure">conjure</a>,
<a href="https://github.com/tpope/vim-fireplace">fireplace</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The babashka nREPL server does not write an <code>.nrepl-port</code> file at
startup, but you can easily write a script that launches the server and
writes the file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-clojure hljs" data-lang="clojure">#!/usr/bin/env bb

(import [java.net ServerSocket]
        [java.io File]
        [java.lang ProcessBuilder$Redirect])

(require '[babashka.wait :as wait])

(let [nrepl-port (with-open [sock (ServerSocket. 0)] (.getLocalPort sock))
      cp (str/join File/pathSeparatorChar ["src" "test"])
      pb (doto (ProcessBuilder. (into ["bb" "--nrepl-server" (str nrepl-port)
                                       "--classpath" cp]
                                      *command-line-args*))
           (.redirectOutput ProcessBuilder$Redirect/INHERIT))
      proc (.start pb)]
  (wait/wait-for-port "localhost" nrepl-port)
  (spit ".nrepl-port" nrepl-port)
  (.deleteOnExit (File. ".nrepl-port"))
  (.waitFor proc))</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_debugging_the_nrepl_server"><a class="anchor" href="#_debugging_the_nrepl_server"></a>Debugging the nREPL server</h4>
<div class="paragraph">
<p>To debug the nREPL server from the binary you can run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ BABASHKA_DEV=true bb --nrepl-server 1667</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will print all the incoming messages.</p>
</div>
<div class="paragraph">
<p>To debug the nREPL server from source:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-clojure hljs" data-lang="clojure">$ git clone https://github.com/borkdude/babashka --recurse-submodules
$ cd babashka
$ BABASHKA_DEV=true clojure -A:main --nrepl-server 1667</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>Copyright (C) 2020 <a href="https://babashka.org">Michiel Borkent</a></p>
  <p>Except where otherwise noted, book.babashka.org is licensed under the <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/">Creative Commons
Attribution-NonCommercial-NoDerivs</a> (CC BY-NC-ND 4.0).</p>
</footer>
<!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script> -->
<!-- <script type="text/javascript"> -->
<!-- docsearch({ -->
<!--   apiKey: '1f3d78fd63fcb687dcc1312aab02a2de', -->
<!--   indexName: 'cider', -->
<!--   inputSelector: '#search-input', -->
<!--   algoliaOptions: { 'facetFilters': ["version:0.26"] }, -->
<!--   debug: false // Set debug to true if you want to inspect the dropdown -->
<!-- }); -->
<!-- </script> -->

<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
